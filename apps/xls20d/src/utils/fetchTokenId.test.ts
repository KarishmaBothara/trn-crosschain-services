import { describe, expect, it, jest } from "@jest/globals";

import { fetchTokenId } from "@trncs/xls20d/utils/fetchTokenId";

const mockMintTransaction = {
	meta: {
		AffectedNodes: [
			{
				ModifiedNode: {
					FinalFields: {
						Account: "rJNQZkUyvhjnCQexQE4m8qdPJUhPcmNWLD",
						Balance: "2892977536",
						Flags: 0,
						MintedNFTokens: 1961,
						OwnerCount: 272,
						Sequence: 30938376,
						TicketCount: 195,
					},
					LedgerEntryType: "AccountRoot",
					LedgerIndex:
						"0C8AC7932EF072F77406CFA4FC71C572380C13D671264D62166C8575DDD41B61",
					PreviousFields: {
						Balance: "2892977548",
						MintedNFTokens: 1960,
						OwnerCount: 273,
						TicketCount: 196,
					},
					PreviousTxnID:
						"66EC98586AC1B529FC1FFB0B22A43FA54ED2D67E61FD2194B75B0AAF7969DC80",
					PreviousTxnLgrSeq: 41032012,
				},
			},
			{
				ModifiedNode: {
					FinalFields: {
						Flags: 0,
						NFTokens: [
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54C592458000001A1",
									URI: "687474703A2F2F666966692D776F726C642F2F3132",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54C6A92710000067A",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303032",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54C9820820000044B",
									URI: "687474703A2F2F666966692D776F726C642F2F313934",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54CC4BFD30000021C",
									URI: "687474703A2F2F666966692D776F726C642F2F313334",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54CD62DF4000006F5",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303930",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D028C05000004C6",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303835",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D30335600000297",
									URI: "687474703A2F2F666966692D776F726C642F2F37",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D43B96F00000770",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335323133",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D5CA26700000068",
									URI: "687474703A2F2F666966692D776F726C642F2F313032",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D6E27B800000541",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335323038",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D9BDEC900000312",
									URI: "687474703A2F2F666966692D776F726C642F2F313333",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54DC8091A000000E3",
									URI: "687474703A2F2F666966692D776F726C642F2F3231",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54DDBB333000005BC",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303632",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E07424C0000038D",
									URI: "687474703A2F2F666966692D776F726C642F2F36",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E339C9D0000015E",
									URI: "687474703A2F2F666966692D776F726C642F2F313436",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E44CEB600000637",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335313835",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E72FDC700000408",
									URI: "687474703A2F2F666966692D776F726C642F2F313236",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E9F6C10000001D9",
									URI: "687474703A2F2F666966692D776F726C642F2F3730",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54EB05A29000006B2",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303233",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54EDF397A00000483",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303531",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F0AC78B00000254",
									URI: "687474703A2F2F666966692D776F726C642F2F313932",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F1DF5AC0000072D",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335313436",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F376EA400000025",
									URI: "687474703A2F2F666966692D776F726C642F2F3330",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F4854FD000004FE",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335313431",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F766B0E000002CF",
									URI: "687474703A2F2F666966692D776F726C642F2F3632",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F890127000007A8",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3336303039",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54FA2FA5F000000A0",
									URI: "687474703A2F2F666966692D776F726C642F2F313438",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54FB5E07000000579",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303032",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54FE116810000034A",
									URI: "687474703A2F2F666966692D776F726C642F2F313839",
								},
							},
						],
						NextPageMin:
							"BD03376F0C05DC5C32689A8571DCFFE1885B99F5885B99F553C2FF5400000095",
						PreviousPageMin:
							"BD03376F0C05DC5C32689A8571DCFFE1885B99F5885B99F54C592458000001A1",
					},
					LedgerEntryType: "NFTokenPage",
					LedgerIndex:
						"BD03376F0C05DC5C32689A8571DCFFE1885B99F5885B99F5500E41D20000011B",
					PreviousFields: {
						NFTokens: [
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54C592458000001A1",
									URI: "687474703A2F2F666966692D776F726C642F2F3132",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54C6A92710000067A",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303032",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54C9820820000044B",
									URI: "687474703A2F2F666966692D776F726C642F2F313934",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54CC4BFD30000021C",
									URI: "687474703A2F2F666966692D776F726C642F2F313334",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54CD62DF4000006F5",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303930",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D028C05000004C6",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303835",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D30335600000297",
									URI: "687474703A2F2F666966692D776F726C642F2F37",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D43B96F00000770",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335323133",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D5CA26700000068",
									URI: "687474703A2F2F666966692D776F726C642F2F313032",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D6E27B800000541",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335323038",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54D9BDEC900000312",
									URI: "687474703A2F2F666966692D776F726C642F2F313333",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54DC8091A000000E3",
									URI: "687474703A2F2F666966692D776F726C642F2F3231",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54DDBB333000005BC",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303632",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E07424C0000038D",
									URI: "687474703A2F2F666966692D776F726C642F2F36",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E339C9D0000015E",
									URI: "687474703A2F2F666966692D776F726C642F2F313436",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E44CEB600000637",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335313835",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E72FDC700000408",
									URI: "687474703A2F2F666966692D776F726C642F2F313236",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54E9F6C10000001D9",
									URI: "687474703A2F2F666966692D776F726C642F2F3730",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54EB05A29000006B2",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303233",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54EDF397A00000483",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303531",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F0AC78B00000254",
									URI: "687474703A2F2F666966692D776F726C642F2F313932",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F1DF5AC0000072D",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335313436",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F376EA400000025",
									URI: "687474703A2F2F666966692D776F726C642F2F3330",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F4854FD000004FE",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335313431",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F766B0E000002CF",
									URI: "687474703A2F2F666966692D776F726C642F2F3632",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54FA2FA5F000000A0",
									URI: "687474703A2F2F666966692D776F726C642F2F313438",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54FB5E07000000579",
									URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3335303032",
								},
							},
							{
								NFToken: {
									NFTokenID:
										"00080000BD03376F0C05DC5C32689A8571DCFFE1885B99F54FE116810000034A",
									URI: "687474703A2F2F666966692D776F726C642F2F313839",
								},
							},
						],
					},
					PreviousTxnID:
						"396B191229A82364DBC71BC2478A29E320C5A71C923E106FC14CCD5643D02460",
					PreviousTxnLgrSeq: 40973573,
				},
			},
			{
				DeletedNode: {
					FinalFields: {
						Account: "rJNQZkUyvhjnCQexQE4m8qdPJUhPcmNWLD",
						Flags: 0,
						OwnerNode: "8",
						PreviousTxnID:
							"67D07FC556CCE2F8B21D3C9C79F1A02B596EE0C552117C920A37A6E5A870D30A",
						PreviousTxnLgrSeq: 40973575,
						TicketSequence: 30938170,
					},
					LedgerEntryType: "Ticket",
					LedgerIndex:
						"BF1BC51C3F46691D295FD2148D15D24DBDF033212BDE1EDFA8DF44122DA2BC60",
				},
			},
			{
				ModifiedNode: {
					FinalFields: {
						Flags: 0,
						IndexNext: "9",
						IndexPrevious: "7",
						Owner: "rJNQZkUyvhjnCQexQE4m8qdPJUhPcmNWLD",
						RootIndex:
							"D87810DEE44851EA554ABC4AF2266623008C024907159BA0C67D19503C8831BE",
					},
					LedgerEntryType: "DirectoryNode",
					LedgerIndex:
						"EEF72F56A9D1F81E41F61DEC01CE0DD3279E51A4DC055B67D855185D7ADC4C50",
				},
			},
		],
		TransactionIndex: 0,
		TransactionResult: "tesSUCCESS",
		nftoken_id:
			"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F890127000007A8",
	},
	tx: {
		Account: "rJNQZkUyvhjnCQexQE4m8qdPJUhPcmNWLD",
		Fee: "12",
		Flags: 9,
		LastLedgerSequence: 41032032,
		Memos: [
			{
				Memo: {
					MemoData: "37393937325F3336303039",
					MemoType: "464946415F4D494E54",
				},
			},
		],
		NFTokenTaxon: 79972,
		Sequence: 0,
		SigningPubKey:
			"037A3B27658D9C1D7A0F00FADCCBF0155185910B2B631FA04223685E762F55EFDF",
		TicketSequence: 30938170,
		TransactionType: "NFTokenMint",
		TransferFee: 0,
		TxnSignature:
			"3044022074ABA1DA872A2D4B1F725CA348D2475ED0E6EAECD3A70A4616D950AC7B11AE3A02205A98DC5F4E6D3EAFE6200322255756C6D9B4C143672B681E0A7D86BFDFD5A597",
		URI: "74726E2D666966612D6D696E742E76657263656C2E6170702F746F6B656E2F3336303039",
		date: 747473842,
		hash: "72853BB107E0BA2FE2C20601A0EF3DE1ED2AA1C743080FF7E3565C9132908885",
		inLedger: 41032014,
		ledger_index: 41032014,
	},
	validated: true,
};

describe("fetchTokenId from tx", () => {
	it(`fetch tokenid from xrpl tx object
		`, async () => {
		const tokenId = await fetchTokenId(mockMintTransaction as any);
		expect(tokenId).toStrictEqual(
			"00090000BD03376F0C05DC5C32689A8571DCFFE1885B99F54F890127000007A8"
		);
	});
});
